# Otus-Bash
Домашнее задание OTUS Linux Professional по теме "Bash"

## Что требуется
Домашнее задание выполнялось на CentOS 7


## Домашнее задание

Написать скрипт для крона, который раз в час присылает на заданную почту:

* IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
* Y запрашиваемых адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
* все ошибки c момента последнего запуска;
* список всех кодов возврата с указанием их кол-ва с момента последнего запуска.
* В письме должно быть прописан обрабатываемый временной диапазон и должна быть реализована защита от мультизапуска.

Скрипт [check_log.sh](https://github.com/gardvor/Otus-Linux/blob/main/Otus-Bash/check_log.sh)

* IP адреса вывод количества ограничиваем пять и больше запросов уникального IP
```
[root@bash vagrant]# cat access-4560-644067.log | awk '{print $1}' | sort | uniq -c | sort -rn | awk '{ if ( $1 >= 5 ) { print "Количество запросов:" $1, "IP:" $2 } }'
Количество запросов:45 IP:93.158.167.130
Количество запросов:39 IP:109.236.252.130
Количество запросов:37 IP:212.57.117.19
Количество запросов:33 IP:188.43.241.106
Количество запросов:31 IP:87.250.233.68
Количество запросов:24 IP:62.75.198.172
...
```
* Y запрашиваемых адресов вывод количества ограничиваем десятью и больше уникальными адресами. В скрипте изаользуется обработка для вывода адреса только при при коде возврата 200

 ```
[root@bash vagrant]# cat access-4560-644067.log|awk '{print $7}'| sort |uniq -c | sort -rn | awk '{ if ( $1 >= 10 ) { print "Количество запросов:" $1, "URL:" $2 } }'
Количество запросов:157 URL:/
Количество запросов:120 URL:/wp-login.php
Количество запросов:57 URL:/xmlrpc.php
Количество запросов:26 URL:/robots.txt
Количество запросов:12 URL:/favicon.ico
Количество запросов:11 URL:400

 ```
* Все ошибки c момента последнего запуска. Выводятся коды возврата. Ошибки отфильтровываются от кода возврата равного 400 и выше.
```
[root@bash vagrant]# cat access-4560-644067.log | cut -d '"' -f3 | cut -d ' ' -f2 | sort | uniq -c | sort -rn | awk '{ if ( $2 >= 400 ) { print "Колличество ошибок:" $1, "Код ошибки:" $2}}'
Колличество ошибок:51 Код ошибки:404
Колличество ошибок:18 Код ошибки:400
Колличество ошибок:3 Код ошибки:500
Колличество ошибок:2 Код ошибки:499
Колличество ошибок:1 Код ошибки:405
Колличество ошибок:1 Код ошибки:403                  
```
* Защита от мультизапуска выполнена по примеру скрипта [trap.sh](https://github.com/gardvor/Otus-Linux/blob/main/Otus-Bash/trap.sh).
 
* Результат вывода
```
Данные за период:14/Aug/2019:04:12:10+0300-15/Aug/2019:00:25:46+0300
Количество запросов:45 IP:93.158.167.130
Количество запросов:39 IP:109.236.252.130
Количество запросов:37 IP:212.57.117.19
Количество запросов:33 IP:188.43.241.106
Количество запросов:31 IP:87.250.233.68
Количество запросов:24 IP:62.75.198.172
Количество запросов:22 IP:148.251.223.21
Количество запросов:20 IP:185.6.8.9
Количество запросов:17 IP:217.118.66.161
Количество запросов:16 IP:95.165.18.146
Количество запросов:12 IP:95.108.181.93
Количество запросов:12 IP:62.210.252.196
Количество запросов:12 IP:185.142.236.35
Количество запросов:12 IP:162.243.13.195
Количество запросов:8 IP:163.179.32.118
Количество запросов:7 IP:87.250.233.75
Количество запросов:6 IP:167.99.14.153
Количество запросов:6 IP:165.22.19.102
Количество запросов:5 IP:71.6.199.23
Количество запросов:5 IP:5.45.203.12

Часто запрашиваемые адреса:
Количество запросов:116 URL:/wp-login.php
Количество запросов:73 URL:/
Количество запросов:57 URL:/xmlrpc.php
Количество запросов:19 URL:/robots.txt
Количество запросов:11 URL:/favicon.ico

Ошибки:
Колличество ошибок:51 Код ошибки:404
Колличество ошибок:18 Код ошибки:400
Колличество ошибок:3 Код ошибки:500
Колличество ошибок:2 Код ошибки:499
Колличество ошибок:1 Код ошибки:405
Колличество ошибок:1 Код ошибки:403
```
